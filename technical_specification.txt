Техническое задание

Проект: TUI-плагин для Neovim — альтернатива функции Remote Hosts из PhpStorm
Цель: Создание инструмента для синхронизации локальных и удалённых файлов (FTP, SFTP, rsync и др.) с возможностью управления подключениями и файловыми операциями через TUI-интерфейс внутри Neovim.

1. Общие сведения

Плагин предназначен для разработчиков, работающих с проектами, размещёнными на удалённых серверах. Основная цель — обеспечить удобный интерфейс для:

добавления и редактирования удалённых хостов;

синхронизации файлов между локальной и удалённой машиной;

просмотра структуры удалённых директорий;

управления загрузкой и скачиванием файлов в соответствии со структурой проекта.

2. Основной функционал
2.1 Управление хостами

Поддержка нескольких хостов (до 10) в конфигурационном файле .remote_hosts_sync.toml, расположенном в корне проекта.

Формат хранения данных:

[[hosts]]
name = "Production Server"
type = "sftp"              # ftp | sftp | rsync | scp | etc.
host = "example.com"
port = 22
user = "deploy"
password = "secret"        # либо путь к ssh-ключу
path = "/var/www/project"
excludes_local = ["node_modules/", ".git/"]
excludes_remote = ["cache/", "logs/"]


Возможность добавления, редактирования и удаления хостов через TUI-интерфейс.

Проверка соединения при добавлении/редактировании хоста.

Поддержка аутентификации по паролю и SSH-ключу.

2.2 Основные команды

:RemoteOpenTree [host_name] — открыть древо удалённого сервера, аналогично neo-tree, с отображением структуры директорий.

:RemoteCloseTree — закрыть древо удалённого сервера.

:RemoteUpload [path] — загрузить указанный локальный файл/папку на сервер, сохраняя структуру директорий.

:RemoteDownload [path] — скачать файл/папку с сервера, сохраняя соответствие путей.

:RemoteSync — синхронизировать изменённые локальные файлы с сервером (основная команда).

:RemoteFetch — скачать все файлы из текущей или выбранной папки.

:RemotePush — загрузить все файлы из текущей или выбранной папки на сервер.

2.3 Работа с файлами

Автоматическая синхронизация изменённых локальных файлов при сохранении (autocmd BufWritePost).

Возможность отключать синхронизацию для отдельных файлов или директорий, указанных в excludes_local.

При загрузке или скачивании файлов структура директорий должна полностью соответствовать (./local/components → <path>/local/components).

Возможность ручного скачивания/обновления выбранного файла через TUI.

Логирование всех действий (загрузка, скачивание, ошибки соединения) в отдельный лог-файл .remote_hosts_sync.log.

2.4 Интерфейс TUI

Интерфейс реализуется на Lua с использованием библиотек telescope.nvim и/или nui.nvim.

Основные экраны:

Список хостов (с действиями: добавить, редактировать, удалить, подключиться).

Древо файлов на сервере с возможностью раскрытия/сворачивания директорий.

Контекстное меню для действий с файлами (скачать, загрузить, обновить, открыть в буфере).

Поддержка клавиатурных сокращений:

r — обновить содержимое текущей директории;

d — скачать файл/папку;

u — загрузить файл/папку;

Enter — открыть файл;

q — закрыть окно TUI.

Поддержка отображения статуса соединения и текущего активного хоста.

3. Дополнительный функционал

Фоновая синхронизация: возможность запуска фонового процесса для постоянного мониторинга изменений и синхронизации.

Сравнение файлов: встроенная команда для сравнения локальной и удалённой версии файла (diff).

Автоматическое переподключение: при потере соединения попытка переподключиться с интервалом 5 секунд.

Индикация состояния: статусная строка с текущим действием (например, “Uploading…”, “Connected to staging”).

Настройки: глобальные параметры в ~/.config/nvim/remote_hosts_sync.toml, переопределяемые локальным файлом проекта.

4. Технические требования

Язык реализации: Lua

Совместимость: Neovim ≥ 0.9

Зависимости:

plenary.nvim

nui.nvim или telescope.nvim

rsync, lftp или ssh — для взаимодействия с удалёнными серверами

Поддержка ОС: Linux, macOS, Windows (через WSL)

Плагин должен быть кроссплатформенным и распространяться публично (через GitHub).

5. Безопасность

Конфиденциальные данные (пароли, ключи) не хранятся в открытом виде при возможности — предпочтительно использование SSH-ключей.

Исключить передачу данных по незащищённым протоколам, если возможно (FTP → FTPS).

Все действия с удалёнными файлами должны выполняться только после подтверждения подключения к хосту.

6. Структура проекта
remote_hosts_sync/
├── lua/
│   ├── core/             # базовая логика, утилиты, обработка TOML
│   ├── tui/              # интерфейсные модули
│   ├── sync/             # синхронизация и работа с файлами
│   └── commands.lua      # регистрация команд Neovim
├── plugin/
│   └── remote_hosts_sync.lua
├── README.md
└── LICENSE
